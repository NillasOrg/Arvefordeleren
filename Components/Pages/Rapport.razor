@page "/rapport"
@using System.IO.Compression
@inject IJSRuntime JS

<div class="main-container">
    <div class="headliner-container">
        <h3>Rapport</h3>
    </div>

    <div class="info">
        
    </div>

    <div class="body">
        <div>

        </div>

        <div class="right-body">
            <RapportListComponent/>
        </div>
        
        <div>
            <button @onclick="_download">Download</button>
        </div>
    </div>
</div>

@code {
    private async Task _download()
    {
        if (AssetsRepository.Assets.Any())
             CSVExporter.AssetsExport(AssetsRepository.Assets);
        
        if (TestatorRepository.testators.Any())
            CSVExporter.TestatorsExport(TestatorRepository.testators);
        
        if (HeirsRepository.Heirs.Any())
            CSVExporter.HeirsExport(HeirsRepository.Heirs);

        if (File.Exists(@"Data/data.zip"))
        {
            File.Delete(@"Data/data.zip");
        }
        
        ZipFile.CreateFromDirectory("Data/Downloads/", "Data/data.zip");
        var fileStream = File.OpenRead(@"Data/data.zip");
        var fileName = "Arvefordeleren.zip";

        using var streamRef = new DotNetStreamReference(stream: fileStream);

        await JS.InvokeVoidAsync("downloadFileFromStream", fileName, streamRef);
    }
}
