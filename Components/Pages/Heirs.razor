@page "/Arvinger"
@using Arvefordeleren.Components.Layout

<div class="HeirContainer">
    <div class="TopContainer">
        <h1>Indtast dine arvinger</h1>
    </div>
    <div class="SelectorContainer">
        @foreach (var heir in HeirsRepository.Heirs)
        {
            <div class="Selector">
                <HeirSelectorComponent Heir="heir" OnClose="HandleClose"/>
            </div>
        }
        
        <div class="Selector" id="ButtonBox">
            <button class="AddButton" @onclick="AddHeir">Tilf√∏j flere (+)</button>
        </div>
    </div>
</div>
@code {
    [CascadingParameter] public NavMenu? NavMenu { get; set; }

    protected override void OnInitialized()
    {
        Validate();
    }

    private void AddHeir()
    {
        HeirsRepository.AddHeir(new Heir());
        StateHasChanged(); 
    }
    
    private void HandleClose(Heir heir)
    {
        HeirsRepository.RemoveHeir(heir.Id);
        StateHasChanged(); 
        Validate();
    }

    private void Validate()
    {
        if (!HeirsRepository.Heirs.Any() && NavMenu != null)
        {
            NavMenu.IsValid = false;
        }
    }
}
